{"version":3,"file":"swiper-list.js","sources":["pages/template/swiper-list/swiper-list.nvue","../../../../../Work-Tools/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcdGVtcGxhdGVcc3dpcGVyLWxpc3Rcc3dpcGVyLWxpc3QubnZ1ZQ"],"sourcesContent":["<template>\r\n    <view class=\"tabs\">\r\n        <scroll-view ref=\"tabbar1\" id=\"tab-bar\" class=\"tab-bar\" :scroll=\"false\" :scroll-x=\"true\" :show-scrollbar=\"false\"\r\n            :scroll-into-view=\"scrollInto\">\r\n            <view style=\"flex-direction: column;\">\r\n                <view style=\"flex-direction: row;\">\r\n                    <view class=\"uni-tab-item\" v-for=\"(tab,index) in tabList\" :key=\"tab.id\" :id=\"tab.id\" :ref=\"'tabitem'+index\"\r\n                        :data-id=\"index\" :data-current=\"index\" @click=\"ontabtap\">\r\n                        <text class=\"uni-tab-item-title\" :class=\"tabIndex==index ? 'uni-tab-item-title-active' : ''\">{{tab.name}}</text>\r\n                    </view>\r\n                </view>\r\n                <view class=\"scroll-view-indicator\">\r\n                    <view ref=\"underline\" class=\"scroll-view-underline\" :class=\"isTap ? 'scroll-view-animation':''\"\r\n                        :style=\"{left: indicatorLineLeft + 'px', width: indicatorLineWidth + 'px'}\"></view>\r\n                </view>\r\n            </view>\r\n        </scroll-view>\r\n        <view class=\"tab-bar-line\"></view>\r\n        <swiper class=\"tab-view\" ref=\"swiper1\" id=\"tab-bar-view\" :current=\"tabIndex\" :duration=\"300\" @change=\"onswiperchange\"\r\n            @transition=\"onswiperscroll\" @animationfinish=\"animationfinish\" @onAnimationEnd=\"animationfinish\">\r\n            <swiper-item class=\"swiper-item\" v-for=\"(page, index) in tabList\" :key=\"index\">\r\n                <!-- #ifndef MP-ALIPAY -->\r\n                <swiperPage class=\"swiper-page\" :pid=\"page.pageid\" ref=\"page\"></swiperPage>\r\n                <!-- #endif -->\r\n                <!-- #ifdef MP-ALIPAY -->\r\n                <swiperPage class=\"swiper-page\" :pid=\"page.pageid\" :ref=\"'page' + index\"></swiperPage>\r\n                <!-- #endif -->\r\n            </swiper-item>\r\n        </swiper>\r\n    </view>\r\n</template>\r\n\r\n<script>\r\n    // #ifdef APP-NVUE\r\n    const dom = weex.requireModule('dom');\r\n    // #endif\r\n\r\n    // 缓存每页最多\r\n    const MAX_CACHE_DATA = 100;\r\n\r\n    // 缓存页签数量\r\n    const MAX_CACHE_PAGE = 3;\r\n    const TAB_PRELOAD_OFFSET = 1;\r\n\r\n    import swiperPage from './swiper-page.nvue';\r\n\r\n    export default {\r\n        components: {\r\n            swiperPage\r\n        },\r\n        data() {\r\n            return {\r\n                tabList: [],\r\n                tabIndex: 0,\r\n                cacheTab: [],\r\n                scrollInto: \"\",\r\n                indicatorLineLeft: 0,\r\n                indicatorLineWidth: 0,\r\n                isTap: false\r\n            }\r\n        },\r\n        onLoad() {\r\n            for (var i = 0; i < 6; i++) {\r\n                this.tabList.push({\r\n                    id: \"tab\" + i,\r\n                    name: 'Tab ' + (i + 1),\r\n                    pageid: i + 1\r\n                })\r\n            }\r\n        },\r\n        onReady() {\r\n            this._lastTabIndex = 0;\r\n            this.swiperWidth = 0;\r\n            this.tabbarWidth = 0;\r\n            this.tabListSize = {};\r\n            this._touchTabIndex = 0;\r\n\r\n            // #ifndef MP-ALIPAY\r\n            this.pageList = this.$refs.page;\r\n            // #endif\r\n            // #ifdef MP-ALIPAY\r\n            this.pageList = [];\r\n            for (var i = 0; i < this.tabList.length; i++) {\r\n                this.pageList.push(this.$refs['page' + i][0]);\r\n            }\r\n            // #endif\r\n            this.switchTab(this.tabIndex);\r\n\r\n            this.getTabbarItemsSize();\r\n        },\r\n        methods: {\r\n            ontabtap(e) {\r\n                let index = e.target.dataset.current || e.currentTarget.dataset.current;\r\n\r\n                // #ifdef APP-PLUS || H5 || MP-WEIXIN || MP-QQ\r\n                this.isTap = true;\r\n                var currentSize = this.tabListSize[index];\r\n                this.updateIndicator(currentSize.left, currentSize.width);\r\n                this._touchTabIndex = index;\r\n                // #endif\r\n\r\n                this.switchTab(index);\r\n            },\r\n            onswiperchange(e) {\r\n                // 注意：百度小程序会触发2次\r\n\r\n                // #ifndef APP-PLUS || H5 || MP-WEIXIN || MP-QQ\r\n                let index = e.target.current || e.detail.current;\r\n                this.switchTab(index);\r\n                // #endif\r\n            },\r\n            onswiperscroll(e) {\r\n                if (this.isTap) {\r\n                    return;\r\n                }\r\n\r\n                var offsetX = e.detail.dx;\r\n                var preloadIndex = this._lastTabIndex;\r\n                if (offsetX > TAB_PRELOAD_OFFSET) {\r\n                    preloadIndex++;\r\n                } else if (offsetX < -TAB_PRELOAD_OFFSET) {\r\n                    preloadIndex--;\r\n                }\r\n                if (preloadIndex === this._lastTabIndex || preloadIndex < 0 || preloadIndex > this.pageList.length - 1) {\r\n                    return;\r\n                }\r\n                if (this.pageList[preloadIndex].dataList.length === 0) {\r\n                    this.loadTabData(preloadIndex);\r\n                }\r\n\r\n                /// 计算 tabbar 底线\r\n                // #ifdef APP-PLUS || H5 || MP-WEIXIN || MP-QQ\r\n                var percentage = Math.abs(this.swiperWidth / offsetX);\r\n                var currentSize = this.tabListSize[this._lastTabIndex];\r\n                var preloadSize = this.tabListSize[preloadIndex];\r\n                var lineL = currentSize.left + (preloadSize.left - currentSize.left) / percentage;\r\n                var lineW = currentSize.width + (preloadSize.width - currentSize.width) / percentage;\r\n                this.updateIndicator(lineL, lineW);\r\n                // #endif\r\n            },\r\n            animationfinish(e) {\r\n                // #ifdef APP-PLUS || H5 || MP-WEIXIN || MP-QQ\r\n                let index = e.detail.current;\r\n                if (this._touchTabIndex === index) {\r\n                    this.isTap = false;\r\n                }\r\n                this._lastTabIndex = index;\r\n                this.switchTab(index);\r\n                this.updateIndicator(this.tabListSize[index].left, this.tabListSize[index].width);\r\n                // #endif\r\n            },\r\n            getTabbarItemsSize() {\r\n                // #ifdef APP-NVUE\r\n                // 查询 tabbar 宽度\r\n                uni.createSelectorQuery().in(this).select('#tab-bar').boundingClientRect().exec(rect => {\r\n                    this.tabbarWidth = rect[0].width;\r\n                });\r\n                // 查询 tabview 宽度\r\n                uni.createSelectorQuery().in(this).select('#tab-bar-view').boundingClientRect().exec(rect => {\r\n                    this.swiperWidth = rect[0].width;\r\n                });\r\n\r\n                // 因 nvue 暂不支持 class 查询\r\n                var queryTabSize = uni.createSelectorQuery().in(this);\r\n                for (var i = 0; i < this.tabList.length; i++) {\r\n                    queryTabSize.select('#' + this.tabList[i].id).boundingClientRect();\r\n                }\r\n                queryTabSize.exec(rects => {\r\n                    console.log(JSON.stringify(rects));\r\n                    rects.forEach((rect) => {\r\n                        this.tabListSize[rect.dataset.id] = rect;\r\n                    })\r\n                });\r\n                // #endif\r\n\r\n                // #ifdef MP-WEIXIN || H5 || MP-QQ\r\n                uni.createSelectorQuery().in(this).select('.tab-view').fields({\r\n                    dataset: true,\r\n                    size: true,\r\n                }, (res) => {\r\n                    this.swiperWidth = res.width;\r\n                }).exec();\r\n                uni.createSelectorQuery().in(this).selectAll('.uni-tab-item').boundingClientRect((rects) => {\r\n                    rects.forEach((rect) => {\r\n                        this.tabListSize[rect.dataset.id] = rect;\r\n                    })\r\n                }).exec();\r\n                // #endif\r\n\r\n                // #ifdef APP-NVUE || H5 || MP-WEIXIN || MP-QQ\r\n                setTimeout(() => {\r\n                    this.updateIndicator(this.tabListSize[this.tabIndex].left, this.tabListSize[this.tabIndex].width);\r\n                }, 100)\r\n                // #endif\r\n            },\r\n            updateIndicator(left, width) {\r\n                this.indicatorLineLeft = left;\r\n                this.indicatorLineWidth = width;\r\n            },\r\n            switchTab(index) {\r\n                if (this.pageList[index].dataList.length === 0) {\r\n                    this.loadTabData(index);\r\n                }\r\n\r\n                if (this.tabIndex === index) {\r\n                    return;\r\n                }\r\n\r\n                // 缓存 tabId\r\n                if (this.pageList[this.tabIndex].dataList.length > MAX_CACHE_DATA) {\r\n                    let isExist = this.cacheTab.indexOf(this.tabIndex);\r\n                    if (isExist < 0) {\r\n                        this.cacheTab.push(this.tabIndex);\r\n                    }\r\n                }\r\n\r\n                this.tabIndex = index;\r\n\r\n                // #ifdef APP-NVUE\r\n                this.scrollTabTo(index);\r\n                // #endif\r\n                // #ifndef APP-NVUE\r\n                this.scrollInto = this.tabList[index].id;\r\n                // #endif\r\n\r\n                // 释放 tabId\r\n                if (this.cacheTab.length > MAX_CACHE_PAGE) {\r\n                    let cacheIndex = this.cacheTab[0];\r\n                    this.clearTabData(cacheIndex);\r\n                    this.cacheTab.splice(0, 1);\r\n                }\r\n            },\r\n            scrollTabTo(index) {\r\n                const el = this.$refs['tabitem' + index][0];\r\n                let offset = 0;\r\n                // TODO fix ios offset\r\n                if (index > 0) {\r\n                    offset = this.tabbarWidth / 2 - this.tabListSize[index].width / 2;\r\n                    if (this.tabListSize[index].right < this.tabbarWidth / 2) {\r\n                        offset = this.tabListSize[0].width;\r\n                    }\r\n                }\r\n                dom.scrollToElement(el, {\r\n                    offset: -offset\r\n                });\r\n            },\r\n            loadTabData(index) {\r\n                this.pageList[index].loadData();\r\n            },\r\n            clearTabData(index) {\r\n                this.pageList[index].clear();\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style>\r\n    /* #ifndef APP-PLUS */\r\n    page {\r\n        width: 100%;\r\n        min-height: 100%;\r\n        display: flex;\r\n    }\r\n\r\n    /* #endif */\r\n\r\n    .tabs {\r\n        flex: 1;\r\n        flex-direction: column;\r\n        overflow: hidden;\r\n        background-color: #ffffff;\r\n        /* #ifdef MP-ALIPAY || MP-BAIDU */\r\n        height: 100vh;\r\n        /* #endif */\r\n    }\r\n\r\n    .tab-bar {\r\n        width: 750rpx;\r\n        height: 84rpx;\r\n        flex-direction: row;\r\n        /* #ifndef APP-PLUS */\r\n        white-space: nowrap;\r\n        /* #endif */\r\n    }\r\n\r\n    /* #ifndef APP-NVUE */\r\n    .tab-bar ::-webkit-scrollbar {\r\n        display: none;\r\n        width: 0 !important;\r\n        height: 0 !important;\r\n        -webkit-appearance: none;\r\n        background: transparent;\r\n    }\r\n\r\n    /* #endif */\r\n\r\n    .scroll-view-indicator {\r\n        position: relative;\r\n        height: 2px;\r\n        background-color: transparent;\r\n    }\r\n\r\n    .scroll-view-underline {\r\n        position: absolute;\r\n        top: 0;\r\n        bottom: 0;\r\n        width: 0;\r\n        background-color: #007AFF;\r\n    }\r\n\r\n    .scroll-view-animation {\r\n        transition-duration: 0.2s;\r\n        transition-property: left;\r\n    }\r\n\r\n    .tab-bar-line {\r\n        height: 1rpx;\r\n        background-color: #cccccc;\r\n    }\r\n\r\n    .tab-view {\r\n        flex: 1;\r\n    }\r\n\r\n    .uni-tab-item {\r\n        /* #ifndef APP-PLUS */\r\n        display: inline-block;\r\n        /* #endif */\r\n        flex-wrap: nowrap;\r\n        padding-left: 25px;\r\n        padding-right: 25px;\r\n    }\r\n\r\n    .uni-tab-item-title {\r\n        color: #555;\r\n        font-size: 30rpx;\r\n        height: 80rpx;\r\n        line-height: 80rpx;\r\n        flex-wrap: nowrap;\r\n        /* #ifndef APP-PLUS */\r\n        white-space: nowrap;\r\n        /* #endif */\r\n    }\r\n\r\n    .uni-tab-item-title-active {\r\n        color: #007AFF;\r\n    }\r\n\r\n    .swiper-item {\r\n        flex: 1;\r\n        flex-direction: column;\r\n    }\r\n\r\n    .swiper-page {\r\n        flex: 1;\r\n        flex-direction: row;\r\n        position: absolute;\r\n        left: 0;\r\n        top: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n    }\r\n</style>\r\n","import MiniProgramPage from 'D:/workspace/2025/wx/wx20250829/天天体验馆/pages/template/swiper-list/swiper-list.nvue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAsCI,MAAM,iBAAiB;AAGvB,MAAM,iBAAiB;AACvB,MAAM,qBAAqB;AAE3B,MAAK,aAAc,MAAW;AAE9B,MAAK,YAAU;AAAA,EACX,YAAY;AAAA,IACR;AAAA,EACH;AAAA,EACD,OAAO;AACH,WAAO;AAAA,MACH,SAAS,CAAE;AAAA,MACX,UAAU;AAAA,MACV,UAAU,CAAE;AAAA,MACZ,YAAY;AAAA,MACZ,mBAAmB;AAAA,MACnB,oBAAoB;AAAA,MACpB,OAAO;AAAA,IACX;AAAA,EACH;AAAA,EACD,SAAS;AACL,aAAS,IAAI,GAAG,IAAI,GAAG,KAAK;AACxB,WAAK,QAAQ,KAAK;AAAA,QACd,IAAI,QAAQ;AAAA,QACZ,MAAM,UAAU,IAAI;AAAA,QACpB,QAAQ,IAAI;AAAA,OACf;AAAA,IACL;AAAA,EACH;AAAA,EACD,UAAU;AACN,SAAK,gBAAgB;AACrB,SAAK,cAAc;AACnB,SAAK,cAAc;AACnB,SAAK,cAAc;AACnB,SAAK,iBAAiB;AAGtB,SAAK,WAAW,KAAK,MAAM;AAQ3B,SAAK,UAAU,KAAK,QAAQ;AAE5B,SAAK,mBAAkB;AAAA,EAC1B;AAAA,EACD,SAAS;AAAA,IACL,SAAS,GAAG;AACR,UAAI,QAAQ,EAAE,OAAO,QAAQ,WAAW,EAAE,cAAc,QAAQ;AAGhE,WAAK,QAAQ;AACb,UAAI,cAAc,KAAK,YAAY,KAAK;AACxC,WAAK,gBAAgB,YAAY,MAAM,YAAY,KAAK;AACxD,WAAK,iBAAiB;AAGtB,WAAK,UAAU,KAAK;AAAA,IACvB;AAAA,IACD,eAAe,GAAG;AAAA,IAOjB;AAAA,IACD,eAAe,GAAG;AACd,UAAI,KAAK,OAAO;AACZ;AAAA,MACJ;AAEA,UAAI,UAAU,EAAE,OAAO;AACvB,UAAI,eAAe,KAAK;AACxB,UAAI,UAAU,oBAAoB;AAC9B;AAAA,MACJ,WAAW,UAAU,CAAC,oBAAoB;AACtC;AAAA,MACJ;AACA,UAAI,iBAAiB,KAAK,iBAAiB,eAAe,KAAK,eAAe,KAAK,SAAS,SAAS,GAAG;AACpG;AAAA,MACJ;AACA,UAAI,KAAK,SAAS,YAAY,EAAE,SAAS,WAAW,GAAG;AACnD,aAAK,YAAY,YAAY;AAAA,MACjC;AAIA,UAAI,aAAa,KAAK,IAAI,KAAK,cAAc,OAAO;AACpD,UAAI,cAAc,KAAK,YAAY,KAAK,aAAa;AACrD,UAAI,cAAc,KAAK,YAAY,YAAY;AAC/C,UAAI,QAAQ,YAAY,QAAQ,YAAY,OAAO,YAAY,QAAQ;AACvE,UAAI,QAAQ,YAAY,SAAS,YAAY,QAAQ,YAAY,SAAS;AAC1E,WAAK,gBAAgB,OAAO,KAAK;AAAA,IAEpC;AAAA,IACD,gBAAgB,GAAG;AAEf,UAAI,QAAQ,EAAE,OAAO;AACrB,UAAI,KAAK,mBAAmB,OAAO;AAC/B,aAAK,QAAQ;AAAA,MACjB;AACA,WAAK,gBAAgB;AACrB,WAAK,UAAU,KAAK;AACpB,WAAK,gBAAgB,KAAK,YAAY,KAAK,EAAE,MAAM,KAAK,YAAY,KAAK,EAAE,KAAK;AAAA,IAEnF;AAAA,IACD,qBAAqB;AAyBjBA,0BAAI,oBAAqB,EAAC,GAAG,IAAI,EAAE,OAAO,WAAW,EAAE,OAAO;AAAA,QAC1D,SAAS;AAAA,QACT,MAAM;AAAA,MACT,GAAE,CAAC,QAAQ;AACR,aAAK,cAAc,IAAI;AAAA,MAC3B,CAAC,EAAE,KAAI;AACPA,0BAAI,sBAAsB,GAAG,IAAI,EAAE,UAAU,eAAe,EAAE,mBAAmB,CAAC,UAAU;AACxF,cAAM,QAAQ,CAAC,SAAS;AACpB,eAAK,YAAY,KAAK,QAAQ,EAAE,IAAI;AAAA,SACvC;AAAA,MACL,CAAC,EAAE,KAAI;AAIP,iBAAW,MAAM;AACb,aAAK,gBAAgB,KAAK,YAAY,KAAK,QAAQ,EAAE,MAAM,KAAK,YAAY,KAAK,QAAQ,EAAE,KAAK;AAAA,MACnG,GAAE,GAAG;AAAA,IAET;AAAA,IACD,gBAAgB,MAAM,OAAO;AACzB,WAAK,oBAAoB;AACzB,WAAK,qBAAqB;AAAA,IAC7B;AAAA,IACD,UAAU,OAAO;AACb,UAAI,KAAK,SAAS,KAAK,EAAE,SAAS,WAAW,GAAG;AAC5C,aAAK,YAAY,KAAK;AAAA,MAC1B;AAEA,UAAI,KAAK,aAAa,OAAO;AACzB;AAAA,MACJ;AAGA,UAAI,KAAK,SAAS,KAAK,QAAQ,EAAE,SAAS,SAAS,gBAAgB;AAC/D,YAAI,UAAU,KAAK,SAAS,QAAQ,KAAK,QAAQ;AACjD,YAAI,UAAU,GAAG;AACb,eAAK,SAAS,KAAK,KAAK,QAAQ;AAAA,QACpC;AAAA,MACJ;AAEA,WAAK,WAAW;AAMhB,WAAK,aAAa,KAAK,QAAQ,KAAK,EAAE;AAItC,UAAI,KAAK,SAAS,SAAS,gBAAgB;AACvC,YAAI,aAAa,KAAK,SAAS,CAAC;AAChC,aAAK,aAAa,UAAU;AAC5B,aAAK,SAAS,OAAO,GAAG,CAAC;AAAA,MAC7B;AAAA,IACH;AAAA,IACD,YAAY,OAAO;AACf,YAAM,KAAK,KAAK,MAAM,YAAY,KAAK,EAAE,CAAC;AAC1C,UAAI,SAAS;AAEb,UAAI,QAAQ,GAAG;AACX,iBAAS,KAAK,cAAc,IAAI,KAAK,YAAY,KAAK,EAAE,QAAQ;AAChE,YAAI,KAAK,YAAY,KAAK,EAAE,QAAQ,KAAK,cAAc,GAAG;AACtD,mBAAS,KAAK,YAAY,CAAC,EAAE;AAAA,QACjC;AAAA,MACJ;AACA,UAAI,gBAAgB,IAAI;AAAA,QACpB,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,IACJ;AAAA,IACD,YAAY,OAAO;AACf,WAAK,SAAS,KAAK,EAAE,SAAQ;AAAA,IAChC;AAAA,IACD,aAAa,OAAO;AAChB,WAAK,SAAS,KAAK,EAAE,MAAK;AAAA,IAC9B;AAAA,EACJ;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5PJ,GAAG,WAAW,eAAe;"}