{"version":3,"file":"get-user-info.js","sources":["pages/API/get-user-info/get-user-info.vue","../../../../../Work-Tools/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcQVBJXGdldC11c2VyLWluZm9cZ2V0LXVzZXItaW5mby52dWU"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<page-head :title=\"title\"></page-head>\r\n\t\t<view class=\"uni-padding-wrap\">\r\n\t\t\t<view style=\"background:#FFF; padding:40rpx;\">\r\n\t\t\t\t<block v-if=\"hasUserInfo === false\">\r\n\t\t\t\t\t<view class=\"uni-hello-text uni-center\">\r\n\t\t\t\t\t\t<text>请点击下方按钮获取用户头像及昵称或手机号</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</block>\r\n\t\t\t\t<block v-if=\"hasUserInfo === true\">\r\n\t\t\t\t\t<view class=\"uni-h4 uni-center uni-common-mt\">{{userInfo.nickName || userInfo.nickname || userInfo.gender || userInfo.email || userInfo.phoneNumber}}</view>\r\n\t\t\t\t\t<view v-if=\"userInfo.avatarUrl || userInfo.avatar_url \" style=\"padding:30rpx 0; text-align:center;\">\r\n\t\t\t\t\t\t<image class=\"userinfo-avatar\" :src=\"userInfo.avatarUrl||userInfo.avatar_url\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</block>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-btn-v\">\r\n\t\t\t\t<!-- #ifdef APP-PLUS || MP-ALIPAY || MP-TOUTIAO -->\r\n\t\t\t\t<button type=\"primary\" :loading=\"btnLoading\" @click=\"getUserInfo\">获取用户信息</button>\r\n\t\t\t\t<!-- #endif -->\r\n\t\t\t\t<!-- #ifdef MP-WEIXIN || MP-BAIDU || MP-QQ  || MP-JD -->\r\n\t\t\t\t<button type=\"primary\" open-type=\"getUserInfo\" @getuserinfo=\"mpGetUserInfo\">获取用户信息</button>\r\n\t\t\t\t<!-- #endif -->\r\n\t\t\t\t<button @click=\"clear\">清空</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations,\r\n\t\tmapActions\r\n\t} from 'vuex'\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: 'getUserInfo',\r\n\t\t\t\thasUserInfo: false,\r\n\t\t\t\tuserInfo: {},\r\n\t\t\t\tbtnLoading: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState([\r\n\t\t\t\t'loginProvider',\r\n\t\t\t\t'isUniverifyLogin'\r\n\t\t\t])\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapActions(['getPhoneNumber']),\r\n\t\t\t// 获取用户信息 API 在小程序可直接使用，在 5+App 里面需要先登录才能调用\r\n\t\t\tgetUserInfo() {\r\n\t\t\t\tthis.btnLoading = true;\r\n\t\t\t\tif (this.isUniverifyLogin) {\r\n\t\t\t\t\t// 一键登录\r\n\t\t\t\t\tthis.getPhoneNumber(uni.getStorageSync('univerifyInfo')).then(phoneNumber => {\r\n\t\t\t\t\t\tthis.hasUserInfo = true;\r\n\t\t\t\t\t\tthis.userInfo = {\r\n\t\t\t\t\t\t\tphoneNumber\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\tconsole.error('getUserInfo fail:', err);\r\n\t\t\t\t\t\tthis.hasUserInfo = false;\r\n\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\tthis.btnLoading = false;\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.loginProvider === 'apple'){\r\n\t\t\t\t\tconst nickname = uni.getStorageSync('apple_nickname')\r\n\t\t\t\t\tif(nickname){\r\n\t\t\t\t\t\tthis.hasUserInfo = true;\r\n\t\t\t\t\t\tthis.userInfo = { nickName:nickname }\r\n\t\t\t\t\t\tthis.btnLoading = false;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuni.getUserInfo({\r\n\t\t\t\t\tprovider: this.loginProvider,\r\n\t\t\t\t\tsuccess: (result) => {\r\n\t\t\t\t\t\tthis.hasUserInfo = true;\r\n\t\t\t\t\t\tthis.userInfo = result.userInfo;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (error) => {\r\n\t\t\t\t\t\tconsole.log('getUserInfo fail', error);\r\n\t\t\t\t\t\tlet content = error.errMsg;\r\n\t\t\t\t\t\tif (~content.indexOf('uni.login')) {\r\n\t\t\t\t\t\t\tcontent = '请在登录页面完成登录操作';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// #ifndef APP-PLUS\r\n\t\t\t\t\t\tuni.getSetting({\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tlet authStatus = res.authSetting['scope.userInfo'];\r\n\t\t\t\t\t\t\t\tif (!authStatus) {\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '授权失败',\r\n\t\t\t\t\t\t\t\t\t\tcontent: 'Hello uni-app需要获取您的用户信息，请在设置界面打开相关权限',\r\n\t\t\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.openSetting()\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '获取用户信息失败',\r\n\t\t\t\t\t\t\t\t\t\tcontent: '错误原因' + content,\r\n\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '获取用户信息失败',\r\n\t\t\t\t\t\t\tcontent: '错误原因' + content,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tthis.btnLoading = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tmpGetUserInfo(result) {\r\n\t\t\t\tconsole.log('mpGetUserInfo', result);\r\n\t\t\t\tif (result.detail.errMsg !== 'getUserInfo:ok') {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '获取用户信息失败',\r\n\t\t\t\t\t\tcontent: '错误原因' + result.detail.errMsg,\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.hasUserInfo = true;\r\n\t\t\t\tif(result.detail && result.detail.userInfo){\r\n\t\t\t\t\tthis.userInfo = result.detail.userInfo;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// #ifdef MP-JD\r\n\t\t\t\t\tthis.userInfo = result.detail.user_info;\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclear() {\r\n\t\t\t\tthis.hasUserInfo = false;\r\n\t\t\t\tthis.userInfo = {};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.userinfo-avatar {\r\n\t\tborder-radius: 128rpx;\r\n\t\twidth: 128rpx;\r\n\t\theight: 128rpx;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'D:/workspace/2025/wx/wx20250829/天天体验馆/pages/API/get-user-info/get-user-info.vue'\nwx.createPage(MiniProgramPage)"],"names":["mapState","mapActions","uni","res"],"mappings":";;AAoCC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,OAAO;AAAA,MACP,aAAa;AAAA,MACb,UAAU,CAAE;AAAA,MACZ,YAAY;AAAA,IACb;AAAA,EACA;AAAA,EACD,UAAU;AAAA,IACT,GAAGA,uBAAS;AAAA,MACX;AAAA,MACA;AAAA,KACA;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACR,GAAGC,cAAU,WAAC,CAAC,gBAAgB,CAAC;AAAA;AAAA,IAEhC,cAAc;AACb,WAAK,aAAa;AAClB,UAAI,KAAK,kBAAkB;AAE1B,aAAK,eAAeC,oBAAI,eAAe,eAAe,CAAC,EAAE,KAAK,iBAAe;AAC5E,eAAK,cAAc;AACnB,eAAK,WAAW;AAAA,YACf;AAAA;QAEF,CAAC,EAAE,MAAM,SAAO;AACfA,wBAAc,MAAA,MAAA,SAAA,mDAAA,qBAAqB,GAAG;AACtC,eAAK,cAAc;AAAA,QACpB,CAAC,EAAE,QAAQ,MAAM;AAChB,eAAK,aAAa;AAAA,SAClB;AACD;AAAA,MACD;AAEA,UAAG,KAAK,kBAAkB,SAAQ;AACjC,cAAM,WAAWA,cAAAA,MAAI,eAAe,gBAAgB;AACpD,YAAG,UAAS;AACX,eAAK,cAAc;AACnB,eAAK,WAAW,EAAE,UAAS,SAAS;AACpC,eAAK,aAAa;AAClB;AAAA,QACD;AAAA,MACD;AAEAA,oBAAAA,MAAI,YAAY;AAAA,QACf,UAAU,KAAK;AAAA,QACf,SAAS,CAAC,WAAW;AACpB,eAAK,cAAc;AACnB,eAAK,WAAW,OAAO;AAAA,QACvB;AAAA,QACD,MAAM,CAAC,UAAU;AAChBA,wBAAY,MAAA,MAAA,OAAA,mDAAA,oBAAoB,KAAK;AACrC,cAAI,UAAU,MAAM;AACpB,cAAI,CAAC,QAAQ,QAAQ,WAAW,GAAG;AAClC,sBAAU;AAAA,UACX;AAEAA,wBAAAA,MAAI,WAAW;AAAA,YACd,SAAS,CAAC,QAAQ;AACjB,kBAAI,aAAa,IAAI,YAAY,gBAAgB;AACjD,kBAAI,CAAC,YAAY;AAChBA,8BAAAA,MAAI,UAAU;AAAA,kBACb,OAAO;AAAA,kBACP,SAAS;AAAA,kBACT,SAAS,CAACC,SAAQ;AACjB,wBAAIA,KAAI,SAAS;AAChBD,oCAAAA,MAAI,YAAY;AAAA,oBACjB;AAAA,kBACD;AAAA,iBACA;AAAA,qBACK;AACNA,8BAAAA,MAAI,UAAU;AAAA,kBACb,OAAO;AAAA,kBACP,SAAS,SAAS;AAAA,kBAClB,YAAY;AAAA,gBACb,CAAC;AAAA,cACF;AAAA,YACD;AAAA,WACA;AAAA,QASD;AAAA,QACD,UAAU,MAAM;AACf,eAAK,aAAa;AAAA,QACnB;AAAA,MACD,CAAC;AAAA,IACD;AAAA,IACD,cAAc,QAAQ;AACrBA,oBAAA,MAAA,MAAA,OAAA,oDAAY,iBAAiB,MAAM;AACnC,UAAI,OAAO,OAAO,WAAW,kBAAkB;AAC9CA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,SAAS,SAAS,OAAO,OAAO;AAAA,UAChC,YAAY;AAAA,QACb,CAAC;AACD;AAAA,MACD;AACA,WAAK,cAAc;AACnB,UAAG,OAAO,UAAU,OAAO,OAAO,UAAS;AAC1C,aAAK,WAAW,OAAO,OAAO;AAAA,MAK/B;AAAA,IACA;AAAA,IACD,QAAQ;AACP,WAAK,cAAc;AACnB,WAAK,WAAW;IACjB;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1JD,GAAG,WAAW,eAAe;"}