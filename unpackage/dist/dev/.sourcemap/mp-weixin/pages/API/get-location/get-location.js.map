{"version":3,"file":"get-location.js","sources":["pages/API/get-location/get-location.vue","../../../../../Work-Tools/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcQVBJXGdldC1sb2NhdGlvblxnZXQtbG9jYXRpb24udnVl"],"sourcesContent":["<template>\r\n    <view>\r\n        <page-head :title=\"title\"></page-head>\r\n        <view class=\"uni-padding-wrap\">\r\n            <view style=\"background:#FFFFFF; padding:40rpx;\">\r\n                <view class=\"uni-hello-text uni-center\">当前位置经纬度</view>\r\n                <block v-if=\"hasLocation === false\">\r\n                    <view class=\"uni-h2 uni-center uni-common-mt\">未获取</view>\r\n                </block>\r\n                <block v-if=\"hasLocation === true\">\r\n                    <view class=\"uni-h2 uni-center uni-common-mt\">\r\n                        <text>E: {{location.longitude[0]}}°{{location.longitude[1]}}′</text>\r\n                        <text>\\nN: {{location.latitude[0]}}°{{location.latitude[1]}}′</text>\r\n                    </view>\r\n                </block>\r\n            </view>\r\n            <view class=\"uni-btn-v\">\r\n                <button type=\"primary\" @tap=\"getLocation\">获取位置</button>\r\n                <button @tap=\"clear\">清空</button>\r\n            </view>\r\n        </view>\r\n        <uni-popup :show=\"type === 'showpopup'\" mode=\"fixed\" @hidePopup=\"togglePopup('')\">\r\n            <view class=\"popup-view\">\r\n                <text class=\"popup-title\">需要用户授权位置权限</text>\r\n                <view class=\"uni-flex popup-buttons\">\r\n                    <button class=\"uni-flex-item\" type=\"primary\" open-type=\"openSetting\" @tap=\"openSetting\">设置</button>\r\n                    <button class=\"uni-flex-item\" @tap=\"togglePopup('')\">取消</button>\r\n                </view>\r\n            </view>\r\n        </uni-popup>\r\n    </view>\r\n</template>\r\n<script>\r\n    import * as util from '../../../common/util.js'\r\n    var formatLocation = util.formatLocation;\r\n    // #ifdef APP-PLUS\r\n    import permision from \"@/common/permission.js\"\r\n    // #endif\r\n\r\n    export default {\r\n        data() {\r\n            return {\r\n                title: 'getLocation',\r\n                hasLocation: false,\r\n                location: {},\r\n                type: ''\r\n            }\r\n        },\r\n        methods: {\r\n            togglePopup(type) {\r\n                this.type = type;\r\n            },\r\n            showConfirm() {\r\n                this.type = 'showpopup';\r\n            },\r\n            hideConfirm() {\r\n                this.type = '';\r\n            },\r\n            async getLocation() {\r\n                // #ifdef APP-PLUS\r\n                let status = await this.checkPermission();\r\n                if (status !== 1) {\r\n                    return;\r\n                }\r\n                // #endif\r\n                // #ifdef MP-WEIXIN || MP-TOUTIAO || MP-QQ\r\n                let status = await this.getSetting();\r\n                if (status === 2) {\r\n                    this.showConfirm();\r\n                    return;\r\n                }\r\n                // #endif\r\n\t\t\t\t// #ifdef MP-HARMONY\n\t\t\t\tuni.authorize({\n\t\t\t\t\tscope: \"scope.userLocation\",\n\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\tthis.doGetLocation();\n\t\t\t\t\t},\n\t\t\t\t\tfail: () => {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: \"未授权获取地理位置权限\"\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// #endif\n\t\t\t\t// #ifndef MP-HARMONY\n\t\t\t\tthis.doGetLocation();\n\t\t\t\t// #endif\r\n            },\r\n            doGetLocation() {\r\n                uni.getLocation({\r\n                    success: (res) => {\r\n                        this.hasLocation = true;\r\n                        this.location = formatLocation(res.longitude, res.latitude);\r\n                    },\r\n                    fail: (err) => {\r\n                        // #ifdef MP-BAIDU\r\n                        if (err.errCode === 202 || err.errCode === 10003) { // 202模拟器 10003真机 user deny\r\n                            this.showConfirm();\r\n                        }\r\n                        // #endif\r\n                        // #ifndef MP-BAIDU\r\n                        if (err.errMsg.indexOf(\"auth deny\") >= 0) {\r\n                            uni.showToast({\r\n                                title: \"访问位置被拒绝\"\r\n                            })\r\n                        } else {\r\n                            uni.showToast({\r\n                                title: err.errMsg\r\n                            })\r\n                        }\r\n                        // #endif\r\n                    }\r\n                })\r\n            },\r\n            getSetting: function() {\r\n                return new Promise((resolve, reject) => {\r\n                    uni.getSetting({\r\n                        success: (res) => {\r\n                            if (res.authSetting['scope.userLocation'] === undefined) {\r\n                                resolve(0);\r\n                                return;\r\n                            }\r\n                            if (res.authSetting['scope.userLocation']) {\r\n                                resolve(1);\r\n                            } else {\r\n                                resolve(2);\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n            },\r\n            openSetting: function() {\r\n                this.hideConfirm();\r\n                uni.openSetting({\r\n                    success: (res) => {\r\n                        if (res.authSetting && res.authSetting['scope.userLocation']) {\r\n                            this.doGetLocation();\r\n                        }\r\n                    },\r\n                    fail: (err) => {}\r\n                })\r\n            },\r\n            async checkPermission() {\r\n                let status = permision.isIOS ? await permision.requestIOS('location') :\r\n                    await permision.requestAndroid('android.permission.ACCESS_FINE_LOCATION');\r\n\r\n                if (status === null || status === 1) {\r\n                    status = 1;\r\n                } else if (status === 2) {\r\n                    uni.showModal({\r\n                        content: \"系统定位已关闭\",\r\n                        confirmText: \"确定\",\r\n                        showCancel: false,\r\n                        success: function(res) {\r\n                        }\r\n                    })\r\n                } else if (status.code) {\r\n                    uni.showModal({\r\n                        content: status.message\r\n                    })\r\n                } else {\r\n                    uni.showModal({\r\n                        content: \"需要定位权限\",\r\n                        confirmText: \"设置\",\r\n                        success: function(res) {\r\n                            if (res.confirm) {\r\n                                permision.gotoAppSetting();\r\n                            }\r\n                        }\r\n                    })\r\n                }\r\n\r\n                return status;\r\n            },\r\n            clear: function() {\r\n                this.hasLocation = false\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style>\r\n    .popup-view {\r\n        width: 500rpx;\r\n    }\r\n\r\n    .popup-title {\r\n        display: block;\r\n        font-size: 16px;\r\n        line-height: 3;\r\n        margin-bottom: 10px;\r\n        text-align: center;\r\n    }\r\n\r\n    .popup-buttons button {\r\n        margin-left: 4px;\r\n        margin-right: 4px;\r\n    }\r\n</style>\r\n","import MiniProgramPage from 'D:/workspace/2025/wx/wx20250829/天天体验馆/pages/API/get-location/get-location.vue'\nwx.createPage(MiniProgramPage)"],"names":["util.formatLocation","uni"],"mappings":";;;AAkCI,IAAI,iBAAiBA,YAAAA;AAKrB,MAAK,YAAU;AAAA,EACX,OAAO;AACH,WAAO;AAAA,MACH,OAAO;AAAA,MACP,aAAa;AAAA,MACb,UAAU,CAAE;AAAA,MACZ,MAAM;AAAA,IACV;AAAA,EACH;AAAA,EACD,SAAS;AAAA,IACL,YAAY,MAAM;AACd,WAAK,OAAO;AAAA,IACf;AAAA,IACD,cAAc;AACV,WAAK,OAAO;AAAA,IACf;AAAA,IACD,cAAc;AACV,WAAK,OAAO;AAAA,IACf;AAAA,IACD,MAAM,cAAc;AAQhB,UAAI,SAAS,MAAM,KAAK;AACxB,UAAI,WAAW,GAAG;AACd,aAAK,YAAW;AAChB;AAAA,MACJ;AAgBZ,WAAK,cAAa;AAAA,IAET;AAAA,IACD,gBAAgB;AACZC,oBAAAA,MAAI,YAAY;AAAA,QACZ,SAAS,CAAC,QAAQ;AACd,eAAK,cAAc;AACnB,eAAK,WAAW,eAAe,IAAI,WAAW,IAAI,QAAQ;AAAA,QAC7D;AAAA,QACD,MAAM,CAAC,QAAQ;AAOX,cAAI,IAAI,OAAO,QAAQ,WAAW,KAAK,GAAG;AACtCA,0BAAAA,MAAI,UAAU;AAAA,cACV,OAAO;AAAA,aACV;AAAA,iBACE;AACHA,0BAAAA,MAAI,UAAU;AAAA,cACV,OAAO,IAAI;AAAA,aACd;AAAA,UACL;AAAA,QAEJ;AAAA,OACH;AAAA,IACJ;AAAA,IACD,YAAY,WAAW;AACnB,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpCA,sBAAAA,MAAI,WAAW;AAAA,UACX,SAAS,CAAC,QAAQ;AACd,gBAAI,IAAI,YAAY,oBAAoB,MAAM,QAAW;AACrD,sBAAQ,CAAC;AACT;AAAA,YACJ;AACA,gBAAI,IAAI,YAAY,oBAAoB,GAAG;AACvC,sBAAQ,CAAC;AAAA,mBACN;AACH,sBAAQ,CAAC;AAAA,YACb;AAAA,UACJ;AAAA,QACJ,CAAC;AAAA,MACL,CAAC;AAAA,IACJ;AAAA,IACD,aAAa,WAAW;AACpB,WAAK,YAAW;AAChBA,oBAAAA,MAAI,YAAY;AAAA,QACZ,SAAS,CAAC,QAAQ;AACd,cAAI,IAAI,eAAe,IAAI,YAAY,oBAAoB,GAAG;AAC1D,iBAAK,cAAa;AAAA,UACtB;AAAA,QACH;AAAA,QACD,MAAM,CAAC,QAAQ;AAAA,QAAC;AAAA,OACnB;AAAA,IACJ;AAAA,IACD,MAAM,kBAAkB;AACpB,UAAI,SAAS,UAAU,QAAQ,MAAM,UAAU,WAAW,UAAU,IAChE,MAAM,UAAU,eAAe,yCAAyC;AAE5E,UAAI,WAAW,QAAQ,WAAW,GAAG;AACjC,iBAAS;AAAA,MACb,WAAW,WAAW,GAAG;AACrBA,sBAAAA,MAAI,UAAU;AAAA,UACV,SAAS;AAAA,UACT,aAAa;AAAA,UACb,YAAY;AAAA,UACZ,SAAS,SAAS,KAAK;AAAA,UACvB;AAAA,SACH;AAAA,MACL,WAAW,OAAO,MAAM;AACpBA,sBAAAA,MAAI,UAAU;AAAA,UACV,SAAS,OAAO;AAAA,SACnB;AAAA,aACE;AACHA,sBAAAA,MAAI,UAAU;AAAA,UACV,SAAS;AAAA,UACT,aAAa;AAAA,UACb,SAAS,SAAS,KAAK;AACnB,gBAAI,IAAI,SAAS;AACb,wBAAU,eAAc;AAAA,YAC5B;AAAA,UACJ;AAAA,SACH;AAAA,MACL;AAEA,aAAO;AAAA,IACV;AAAA,IACD,OAAO,WAAW;AACd,WAAK,cAAc;AAAA,IACvB;AAAA,EACJ;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClLJ,GAAG,WAAW,eAAe;"}