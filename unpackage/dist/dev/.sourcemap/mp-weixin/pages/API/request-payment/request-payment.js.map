{"version":3,"file":"request-payment.js","sources":["pages/API/request-payment/request-payment.vue","../../../../../Work-Tools/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcQVBJXHJlcXVlc3QtcGF5bWVudFxyZXF1ZXN0LXBheW1lbnQudnVl"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<page-head :title=\"title\"></page-head>\r\n\t\t<view class=\"uni-padding-wrap\">\r\n\t\t\t<view style=\"background:#FFF; padding:50rpx 0;\">\r\n\t\t\t\t<view class=\"uni-hello-text uni-center\"><text>支付金额</text></view>\r\n\t\t\t\t<view class=\"uni-h1 uni-center uni-common-mt\">\r\n\t\t\t\t\t<text class=\"rmbLogo\">￥</text>\r\n\t\t\t\t\t<input class=\"price\" type=\"digit\" :value=\"price\" maxlength=\"4\" @input=\"priceChange\" />\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-btn-v uni-common-mt\">\r\n\t\t\t\t<!-- #ifdef MP-WEIXIN -->\r\n\t\t\t\t<button type=\"primary\" @click=\"weixinPay\" :loading=\"loading\">微信支付</button>\r\n\t\t\t\t<!-- #endif -->\r\n\t\t\t\t<!-- #ifdef APP-PLUS -->\r\n\t\t\t\t<template v-if=\"providerList.length > 0\">\r\n\t\t\t\t\t<button v-for=\"(item,index) in providerList\" :key=\"index\" @click=\"requestPayment(item,index)\" :loading=\"item.loading\">{{item.name}}支付</button>\r\n\t\t\t\t</template>\r\n\t\t\t\t<!-- #endif -->\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: 'request-payment',\r\n\t\t\t\tloading: false,\r\n\t\t\t\tprice: 1,\r\n\t\t\t\tproviderList: []\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad: function() {\r\n\t\t\t// #ifdef APP-PLUS\r\n\t\t\tuni.getProvider({\r\n\t\t\t\tservice: \"payment\",\r\n\t\t\t\tsuccess: (e) => {\r\n\t\t\t\t\tconsole.log(\"payment success:\" + JSON.stringify(e));\r\n\t\t\t\t\tlet providerList = [];\r\n\t\t\t\t\te.provider.map((value) => {\r\n\t\t\t\t\t\tswitch (value) {\r\n\t\t\t\t\t\t\tcase 'alipay':\r\n\t\t\t\t\t\t\t\tproviderList.push({\r\n\t\t\t\t\t\t\t\t\tname: '支付宝',\r\n\t\t\t\t\t\t\t\t\tid: value,\r\n\t\t\t\t\t\t\t\t\tloading: false\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'wxpay':\r\n\t\t\t\t\t\t\t\tproviderList.push({\r\n\t\t\t\t\t\t\t\t\tname: '微信',\r\n\t\t\t\t\t\t\t\t\tid: value,\r\n\t\t\t\t\t\t\t\t\tloading: false\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'huawei':\n\t\t\t\t\t\t\t\tproviderList.push({\n\t\t\t\t\t\t\t\t\tname: '华为',\n\t\t\t\t\t\t\t\t\tid: value,\n\t\t\t\t\t\t\t\t\tloading: false\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.providerList = providerList;\r\n\t\t\t\t},\r\n\t\t\t\tfail: (e) => {\r\n\t\t\t\t\tconsole.log(\"获取支付通道失败：\", e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tloginMpWeixin() {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\tuni.login({\r\n\t\t\t\t\t\tprovider: 'weixin',\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tconsole.warn('此处使用uni-id处理微信小程序登录，详情参考: https://uniapp.dcloud.net.cn/uniCloud/uni-id')\r\n\t\t\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\t\t\turl: 'https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/user-center',\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\taction: 'loginByWeixin',\r\n\t\t\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\t\t\tcode: res.code,\r\n\t\t\t\t\t\t\t\t\t\tplatform: 'mp-weixin'\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\t\t\tif (res.data.code !== 0) {\r\n\t\t\t\t\t\t\t\t\t\treject(new Error('获取openid失败：', res.result.msg))\r\n\t\t\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('openid', res.data.openid)\r\n\t\t\t\t\t\t\t\t\tresolve(res.data.openid)\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\t\t\treject(new Error('获取openid失败：' + err))\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\treject(err)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync weixinPay() {\r\n\t\t\t\tlet openid = uni.getStorageSync('openid')\r\n\t\t\t\tconsole.log(\"发起支付\");\r\n\t\t\t\tthis.loading = true;\r\n\t\t\t\tif (!openid) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\topenid = await this.loginMpWeixin()\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!openid) {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: '获取openid失败',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.loading = false\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.openid = openid\r\n\t\t\t\tlet orderInfo = await this.getOrderInfo('wxpay')\r\n\t\t\t\tif (!orderInfo) {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: '获取支付信息失败',\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tuni.requestPayment({\r\n\t\t\t\t\t...orderInfo,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: \"感谢您的赞助!\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: \"支付失败,原因为: \" + res\r\n\t\t\t\t\t\t\t\t.errMsg,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync requestPayment(e, index) {\r\n\t\t\t\tthis.providerList[index].loading = true;\r\n\t\t\t\tconst provider = e.id\r\n\t\t\t\tlet orderInfo = await this.getOrderInfo(provider);\r\n\t\t\t\tif (!orderInfo) {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: '获取支付信息失败',\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log('--------orderInfo--------')\r\n\t\t\t\tconsole.log(orderInfo);\r\n\t\t\t\tuni.requestPayment({\r\n\t\t\t\t\tprovider,\r\n\t\t\t\t\torderInfo: orderInfo,\r\n\t\t\t\t\tsuccess: (e) => {\r\n\t\t\t\t\t\tconsole.log(\"success\", e);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: \"感谢您的赞助!\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (e) => {\r\n\t\t\t\t\t\tconsole.log(\"fail\", e);\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: \"支付失败,原因为: \" + e.errMsg,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tthis.providerList[index].loading = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetOrderInfo(provider) {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\tif (!this.price) {\r\n\t\t\t\t\t\treject(new Error('请输入金额'))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.warn('此处使用uni-pay处理支付，详情参考: https://uniapp.dcloud.io/uniCloud/unipay')\r\n\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\turl: 'https://97fca9f2-41f6-449f-a35e-3f135d4c3875.bspapp.com/http/pay',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tprovider,\r\n\t\t\t\t\t\t\topenid: this.openid,\r\n\t\t\t\t\t\t\ttotalFee: Number(this.price) * 100, // 转为以分为单位\r\n\t\t\t\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\t\t\t\tplatform: 'app-plus',\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\t\t\t\tplatform: 'mp-weixin',\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tif (res.data.code === 0) {\r\n\t\t\t\t\t\t\t\tresolve(res.data.orderInfo)\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treject(new Error('获取支付信息失败' + res.data.msg))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\treject(new Error('请求支付接口失败' + err))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpriceChange(e) {\r\n\t\t\t\tconsole.log(e.detail.value)\r\n\t\t\t\tthis.price = e.detail.value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.rmbLogo {\r\n\t\tfont-size: 40rpx;\r\n\t}\r\n\r\n\tbutton {\r\n\t\tbackground-color: #007aff;\r\n\t\tcolor: #ffffff;\r\n\t}\r\n\r\n\t.uni-h1.uni-center {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: center;\r\n\t\talign-items: flex-end;\r\n\t}\r\n\r\n\t.price {\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t\twidth: 200rpx;\r\n\t\theight: 80rpx;\r\n\t\tpadding-bottom: 4rpx;\r\n\t}\r\n\r\n\t.ipaPayBtn {\r\n\t\tmargin-top: 30rpx;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'D:/workspace/2025/wx/wx20250829/天天体验馆/pages/API/request-payment/request-payment.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","res","e"],"mappings":"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"}