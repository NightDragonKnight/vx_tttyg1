{"version":3,"file":"permission.js","sources":["common/permission.js"],"sourcesContent":["/// null = 未请求，1 = 已允许，0 = 拒绝|受限, 2 = 系统未开启\r\n\r\nvar isIOS\r\n\r\nfunction album() {\r\n    var result = 0;\r\n    var PHPhotoLibrary = plus.ios.import(\"PHPhotoLibrary\");\r\n    var authStatus = PHPhotoLibrary.authorizationStatus();\r\n    if (authStatus === 0) {\r\n        result = null;\r\n    } else if (authStatus == 3) {\r\n        result = 1;\r\n    } else {\r\n        result = 0;\r\n    }\r\n    plus.ios.deleteObject(PHPhotoLibrary);\r\n    return result;\r\n}\r\n\r\nfunction camera() {\r\n    var result = 0;\r\n    var AVCaptureDevice = plus.ios.import(\"AVCaptureDevice\");\r\n    var authStatus = AVCaptureDevice.authorizationStatusForMediaType('vide');\r\n    if (authStatus === 0) {\r\n        result = null;\r\n    } else if (authStatus == 3) {\r\n        result = 1;\r\n    } else {\r\n        result = 0;\r\n    }\r\n    plus.ios.deleteObject(AVCaptureDevice);\r\n    return result;\r\n}\r\n\r\nfunction location() {\r\n    var result = 0;\r\n    var cllocationManger = plus.ios.import(\"CLLocationManager\");\r\n    var enable = cllocationManger.locationServicesEnabled();\r\n    var status = cllocationManger.authorizationStatus();\r\n    if (!enable) {\r\n        result = 2;\r\n    } else if (status === 0) {\r\n        result = null;\r\n    } else if (status === 3 || status === 4) {\r\n        result = 1;\r\n    } else {\r\n        result = 0;\r\n    }\r\n    plus.ios.deleteObject(cllocationManger);\r\n    return result;\r\n}\r\n\r\nfunction push() {\r\n    var result = 0;\r\n    var UIApplication = plus.ios.import(\"UIApplication\");\r\n    var app = UIApplication.sharedApplication();\r\n    var enabledTypes = 0;\r\n    if (app.currentUserNotificationSettings) {\r\n        var settings = app.currentUserNotificationSettings();\r\n        enabledTypes = settings.plusGetAttribute(\"types\");\r\n        if (enabledTypes == 0) {\r\n            result = 0;\r\n            console.log(\"推送权限没有开启\");\r\n        } else {\r\n            result = 1;\r\n            console.log(\"已经开启推送功能!\")\r\n        }\r\n        plus.ios.deleteObject(settings);\r\n    } else {\r\n        enabledTypes = app.enabledRemoteNotificationTypes();\r\n        if (enabledTypes == 0) {\r\n            result = 3;\r\n            console.log(\"推送权限没有开启!\");\r\n        } else {\r\n            result = 4;\r\n            console.log(\"已经开启推送功能!\")\r\n        }\r\n    }\r\n    plus.ios.deleteObject(app);\r\n    plus.ios.deleteObject(UIApplication);\r\n    return result;\r\n}\r\n\r\nfunction contact() {\r\n    var result = 0;\r\n    var CNContactStore = plus.ios.import(\"CNContactStore\");\r\n    var cnAuthStatus = CNContactStore.authorizationStatusForEntityType(0);\r\n    if (cnAuthStatus === 0) {\r\n        result = null;\r\n    } else if (cnAuthStatus == 3) {\r\n        result = 1;\r\n    } else {\r\n        result = 0;\r\n    }\r\n    plus.ios.deleteObject(CNContactStore);\r\n    return result;\r\n}\r\n\r\nfunction record() {\r\n    var result = null;\r\n    var avaudiosession = plus.ios.import(\"AVAudioSession\");\r\n    var avaudio = avaudiosession.sharedInstance();\r\n    var status = avaudio.recordPermission();\r\n    console.log(\"permissionStatus:\" + status);\r\n    if (status === 1970168948) {\r\n        result = null;\r\n    } else if (status === 1735552628) {\r\n        result = 1;\r\n    } else {\r\n        result = 0;\r\n    }\r\n    plus.ios.deleteObject(avaudiosession);\r\n    return result;\r\n}\r\n\r\nfunction calendar() {\r\n    var result = null;\r\n    var EKEventStore = plus.ios.import(\"EKEventStore\");\r\n    var ekAuthStatus = EKEventStore.authorizationStatusForEntityType(0);\r\n    if (ekAuthStatus == 3) {\r\n        result = 1;\r\n        console.log(\"日历权限已经开启\");\r\n    } else {\r\n        console.log(\"日历权限没有开启\");\r\n    }\r\n    plus.ios.deleteObject(EKEventStore);\r\n    return result;\r\n}\r\n\r\nfunction memo() {\r\n    var result = null;\r\n    var EKEventStore = plus.ios.import(\"EKEventStore\");\r\n    var ekAuthStatus = EKEventStore.authorizationStatusForEntityType(1);\r\n    if (ekAuthStatus == 3) {\r\n        result = 1;\r\n        console.log(\"备忘录权限已经开启\");\r\n    } else {\r\n        console.log(\"备忘录权限没有开启\");\r\n    }\r\n    plus.ios.deleteObject(EKEventStore);\r\n    return result;\r\n}\r\n\r\n\r\nfunction requestIOS(permissionID) {\r\n    return new Promise((resolve, reject) => {\r\n        switch (permissionID) {\r\n            case \"push\":\r\n                resolve(push());\r\n                break;\r\n            case \"location\":\r\n                resolve(location());\r\n                break;\r\n            case \"record\":\r\n                resolve(record());\r\n                break;\r\n            case \"camera\":\r\n                resolve(camera());\r\n                break;\r\n            case \"album\":\r\n                resolve(album());\r\n                break;\r\n            case \"contact\":\r\n                resolve(contact());\r\n                break;\r\n            case \"calendar\":\r\n                resolve(calendar());\r\n                break;\r\n            case \"memo\":\r\n                resolve(memo());\r\n                break;\r\n            default:\r\n                resolve(0);\r\n                break;\r\n        }\r\n    });\r\n}\r\n\r\nfunction requestAndroid(permissionID) {\r\n    return new Promise((resolve, reject) => {\r\n        plus.android.requestPermissions(\r\n            [permissionID],\r\n            function(resultObj) {\r\n                var result = 0;\r\n                for (var i = 0; i < resultObj.granted.length; i++) {\r\n                    var grantedPermission = resultObj.granted[i];\r\n                    console.log('已获取的权限：' + grantedPermission);\r\n                    result = 1\r\n                }\r\n                for (var i = 0; i < resultObj.deniedPresent.length; i++) {\r\n                    var deniedPresentPermission = resultObj.deniedPresent[i];\r\n                    console.log('拒绝本次申请的权限：' + deniedPresentPermission);\r\n                    result = 0\r\n                }\r\n                for (var i = 0; i < resultObj.deniedAlways.length; i++) {\r\n                    var deniedAlwaysPermission = resultObj.deniedAlways[i];\r\n                    console.log('永久拒绝申请的权限：' + deniedAlwaysPermission);\r\n                    result = -1\r\n                }\r\n                resolve(result);\r\n            },\r\n            function(error) {\r\n                console.log('result error: ' + error.message)\r\n                resolve({\r\n                    code: error.code,\r\n                    message: error.message\r\n                });\r\n            }\r\n        );\r\n    });\r\n}\r\n\r\nfunction gotoAppPermissionSetting() {\r\n    if (permission.isIOS) {\r\n        var UIApplication = plus.ios.import(\"UIApplication\");\r\n        var application2 = UIApplication.sharedApplication();\r\n        var NSURL2 = plus.ios.import(\"NSURL\");\r\n        var setting2 = NSURL2.URLWithString(\"app-settings:\");\r\n        application2.openURL(setting2);\r\n        plus.ios.deleteObject(setting2);\r\n        plus.ios.deleteObject(NSURL2);\r\n        plus.ios.deleteObject(application2);\r\n    } else {\r\n        var Intent = plus.android.importClass(\"android.content.Intent\");\r\n        var Settings = plus.android.importClass(\"android.provider.Settings\");\r\n        var Uri = plus.android.importClass(\"android.net.Uri\");\r\n        var mainActivity = plus.android.runtimeMainActivity();\r\n        var intent = new Intent();\r\n        intent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);\r\n        var uri = Uri.fromParts(\"package\", mainActivity.getPackageName(), null);\r\n        intent.setData(uri);\r\n        mainActivity.startActivity(intent);\r\n    }\r\n}\r\n\r\nconst permission = {\r\n    get isIOS(){\r\n        return typeof isIOS === 'boolean' ? isIOS : (isIOS = uni.getSystemInfoSync().platform === 'ios')\r\n    },\r\n    requestIOS: requestIOS,\r\n    requestAndroid: requestAndroid,\r\n    gotoAppSetting: gotoAppPermissionSetting\r\n}\r\n\r\nexport default permission\r\n"],"names":["uni"],"mappings":"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"}